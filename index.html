<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Playable Monopoly Prototype</title>
    <style>
        :root {
            --board-size: 800px; /* Adjust baseline size */
        }

        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background-color: #2c3e50;
            display: flex;
            flex-direction: column;
            align-items: center;
            color: white;
            margin: 0;
            padding: 20px;
        }

        #game-container {
            display: flex;
            gap: 20px;
            background-color: #34495e;
            padding: 20px;
            border-radius: 15px;
            box-shadow: 0 10px 20px rgba(0,0,0,0.3);
        }

        /* --- THE BOARD --- */
        #board-wrapper {
            position: relative;
            width: var(--board-size);
            height: var(--board-size);
            background-image: url('monopoly_board.png'); /* IMPORTANT: Must match your filename */
            background-size: cover;
            border-radius: 2px;
            box-shadow: 0 0 15px rgba(0,0,0,0.5);
        }

        /* Player Tokens */
        .token {
            position: absolute;
            width: 4%;
            height: 4%;
            border-radius: 50%;
            border: 3px solid white;
            box-shadow: 2px 2px 5px rgba(0,0,0,0.5);
            transition: all 0.5s ease-in-out;
            z-index: 10;
            /* Center the token on the coordinate point */
            transform: translate(-50%, -50%); 
        }

        #p1-token { background-color: red; }
        #p2-token { background-color: blue; top: 50%; left: 50%;}

        /* Offset slightly so tokens don't perfectly overlap */
        #p1-token.offset { margin-left: -2%; margin-top: -2%; }
        #p2-token.offset { margin-left: 2%; margin-top: 2%; }


        /* --- CONTROLS & UI --- */
        #controls-container {
            width: 300px;
            display: flex;
            flex-direction: column;
            gap: 15px;
        }

        .panel {
            background: rgba(0,0,0,0.2);
            padding: 15px;
            border-radius: 8px;
        }

        h2 { margin-top: 0; }

        .player-info {
            display: flex;
            justify-content: space-between;
            margin-bottom: 5px;
        }

        .p1-score { color: #ff6b6b; }
        .p2-score { color: #54a0ff; }

        #dice-area {
            text-align: center;
            font-size: 2em;
            font-weight: bold;
            padding: 10px;
            background: white;
            color: black;
            border-radius: 8px;
        }

        button {
            padding: 12px 24px;
            font-size: 1.1em;
            cursor: pointer;
            background-color: #27ae60;
            color: white;
            border: none;
            border-radius: 5px;
            width: 100%;
            transition: background-color 0.2s;
        }
        button:hover { background-color: #2ecc71; }
        button:disabled { background-color: #7f8c8d; cursor: not-allowed; }

        #action-area {
            display: none; /* Hidden until needed */
            background-color: #e67e22;
        }

        #game-log {
            height: 150px;
            overflow-y: auto;
            font-size: 0.9em;
            background: rgba(0,0,0,0.4);
            padding: 10px;
            border-radius: 4px;
        }
        .log-entry { margin-bottom: 4px; }

        /* Responsive adjustments for smaller screens */
        @media (max-width: 1200px) {
            :root { --board-size: 600px; }
        }
        @media (max-width: 950px) {
            #game-container { flex-direction: column; }
            #controls-container { width: var(--board-size); }
            #game-log { height: 100px; }
        }
        @media (max-width: 650px) {
            :root { --board-size: 95vw; }
        }

    </style>
</head>
<body>

    <h1>Monopoly Prototype</h1>

    <div id="game-container">
        <div id="board-wrapper">
            <div id="p1-token" class="token offset" style="top: 93%; left: 93%;"></div>
            <div id="p2-token" class="token offset" style="top: 93%; left: 93%;"></div>
        </div>

        <div id="controls-container">
            <div class="panel">
                <h2>Players</h2>
                <div class="player-info p1-score">Player 1 (Red): $<span id="p1-money">1500</span></div>
                <div class="player-info p2-score">Player 2 (Blue): $<span id="p2-money">1500</span></div>
                <p>Current Turn: <span id="current-player-turn" style="font-weight:bold; color: red;">Player 1</span></p>
            </div>

            <div class="panel">
                <div id="dice-area">Roll Dice</div>
            </div>

            <button id="roll-btn">ROLL DICE</button>

            <div class="panel" id="action-area">
                <h3 id="property-name">Property Name</h3>
                <p id="property-cost">Cost: $0</p>
                <button id="buy-btn">BUY PROPERTY</button>
            </div>

            <div class="panel">
                <h3>Game Log</h3>
                <div id="game-log"></div>
            </div>
        </div>
    </div>


    <script>
        // --- CONFIGURATION & STATE ---
        
        // MAPPING THE BOARD IMAGE
        // This is the crucial part: defining the center point (in percentages) 
        // of every square on the provided image, starting from GO clock-wise.
        const boardMapping = [
            { name: "GO", type: "go", top: 93, left: 93 }, // 0
            { name: "Mediterranean Ave", type: "property", price: 60, rent: 2, owner: null, top: 93, left: 85.5 },
            { name: "Community Chest (Bottom)", type: "chest", top: 93, left: 77.5 },
            { name: "Baltic Ave", type: "property", price: 60, rent: 4, owner: null, top: 93, left: 69.5 },
            { name: "Income Tax", type: "tax", cost: 200, top: 93, left: 61.5 },
            { name: "Reading Railroad", type: "railroad", price: 200, rent: 25, owner: null, top: 93, left: 53.5 },
            { name: "Oriental Ave", type: "property", price: 100, rent: 6, owner: null, top: 93, left: 45.5 },
            { name: "Chance (Bottom)", type: "chance", top: 93, left: 37.5 },
            { name: "Vermont Ave", type: "property", price: 100, rent: 6, owner: null, top: 93, left: 29.5 },
            { name: "Connecticut Ave", type: "property", price: 120, rent: 8, owner: null, top: 93, left: 21.5 },
            { name: "In Jail / Just Visiting", type: "jail", top: 93, left: 7 }, // 10
            { name: "St. Charles Place", type: "property", price: 140, rent: 10, owner: null, top: 85.5, left: 7 },
            { name: "Electric Company", type: "utility", price: 150, owner: null, top: 77.5, left: 7 },
            { name: "States Ave", type: "property", price: 140, rent: 10, owner: null, top: 69.5, left: 7 },
            { name: "Virginia Ave", type: "property", price: 160, rent: 12, owner: null, top: 61.5, left: 7 },
            { name: "Pennsylvania Railroad", type: "railroad", price: 200, rent: 25, owner: null, top: 53.5, left: 7 },
            { name: "St. James Place", type: "property", price: 180, rent: 14, owner: null, top: 45.5, left: 7 },
            { name: "Community Chest (Left)", type: "chest", top: 37.5, left: 7 },
            { name: "Tennessee Ave", type: "property", price: 180, rent: 14, owner: null, top: 29.5, left: 7 },
            { name: "New York Ave", type: "property", price: 200, rent: 16, owner: null, top: 21.5, left: 7 },
            { name: "Free Parking", type: "parking", top: 7, left: 7 }, // 20
            { name: "Kentucky Ave", type: "property", price: 220, rent: 18, owner: null, top: 7, left: 21.5 },
            { name: "Chance (Top)", type: "chance", top: 7, left: 29.5 },
            { name: "Indiana Ave", type: "property", price: 220, rent: 18, owner: null, top: 7, left: 37.5 },
            { name: "Illinois Ave", type: "property", price: 240, rent: 20, owner: null, top: 7, left: 45.5 },
            { name: "B. & O. Railroad", type: "railroad", price: 200, rent: 25, owner: null, top: 7, left: 53.5 },
            { name: "Atlantic Ave", type: "property", price: 260, rent: 22, owner: null, top: 7, left: 61.5 },
            { name: "Ventnor Ave", type: "property", price: 260, rent: 22, owner: null, top: 7, left: 69.5 },
            { name: "Water Works", type: "utility", price: 150, owner: null, top: 7, left: 77.5 },
            { name: "Marvin Gardens", type: "property", price: 280, rent: 24, owner: null, top: 7, left: 85.5 },
            { name: "Go To Jail", type: "gotojail", top: 7, left: 93 }, // 30
            { name: "Pacific Ave", type: "property", price: 300, rent: 26, owner: null, top: 21.5, left: 93 },
            { name: "North Carolina Ave", type: "property", price: 300, rent: 26, owner: null, top: 29.5, left: 93 },
            { name: "Community Chest (Right)", type: "chest", top: 37.5, left: 93 },
            { name: "Pennsylvania Ave", type: "property", price: 320, rent: 28, owner: null, top: 45.5, left: 93 },
            { name: "Short Line Railroad", type: "railroad", price: 200, rent: 25, owner: null, top: 53.5, left: 93 },
            { name: "Chance (Right)", type: "chance", top: 61.5, left: 93 },
            { name: "Park Place", type: "property", price: 350, rent: 35, owner: null, top: 69.5, left: 93 },
            { name: "Luxury Tax", type: "tax", cost: 100, top: 77.5, left: 93 },
            { name: "Boardwalk", type: "property", price: 400, rent: 50, owner: null, top: 85.5, left: 93 },
        ];

        let players = [
            { id: 1, name: "Player 1", color: "red", position: 0, money: 1500, jail: false },
            { id: 2, name: "Player 2", color: "blue", position: 0, money: 1500, jail: false }
        ];
        
        let currentPlayerIndex = 0; // Start with Player 1 (index 0)
        let doublesCount = 0;
        let isRolling = false;

        // --- DOM ELEMENTS ---
        const rollBtn = document.getElementById('roll-btn');
        const diceArea = document.getElementById('dice-area');
        const gameLog = document.getElementById('game-log');
        const actionArea = document.getElementById('action-area');
        const buyBtn = document.getElementById('buy-btn');
        const p1MoneyDisplay = document.getElementById('p1-money');
        const p2MoneyDisplay = document.getElementById('p2-money');
        const turnIndicator = document.getElementById('current-player-turn');

        // --- GAME LOGIC ---

        function addLog(message) {
            const entry = document.createElement('div');
            entry.className = 'log-entry';
            entry.textContent = message;
            gameLog.appendChild(entry);
            gameLog.scrollTop = gameLog.scrollHeight;
        }

        function updateUI() {
            p1MoneyDisplay.textContent = players[0].money;
            p2MoneyDisplay.textContent = players[1].money;
            
            const currentPlayer = players[currentPlayerIndex];
            turnIndicator.textContent = currentPlayer.name;
            turnIndicator.style.color = currentPlayer.color;

            // Hide action area by default at start of turn
            actionArea.style.display = 'none'; 
        }

        function movePlayerToken(playerIndex) {
            const player = players[playerIndex];
            const token = document.getElementById(`p${player.id}-token`);
            const targetSquare = boardMapping[player.position];

            token.style.top = targetSquare.top + "%";
            token.style.left = targetSquare.left + "%";
        }

        async function rollDice() {
            if (isRolling) return;
            isRolling = true;
            rollBtn.disabled = true;
            actionArea.style.display = 'none';

            // Simple dice animation effect
            for(let i=0; i<10; i++) {
                diceArea.textContent = `${Math.floor(Math.random()*6)+1} & ${Math.floor(Math.random()*6)+1}`;
                await new Promise(r => setTimeout(r, 50));
            }

            const d1 = Math.floor(Math.random() * 6) + 1;
            const d2 = Math.floor(Math.random() * 6) + 1;
            const total = d1 + d2;
            const isDoubles = d1 === d2;

            diceArea.textContent = `${d1} & ${d2} (Total: ${total})`;
            addLog(`${players[currentPlayerIndex].name} rolled ${d1} + ${d2} = ${total}.`);

            if (isDoubles) {
                doublesCount++;
                addLog("Doubles!");
            } else {
                doublesCount = 0;
            }
            
            // Handle Speeding (3 doubles goes to jail)
            if (doublesCount >= 3) {
                 addLog("Three doubles! Go to Jail.");
                 sendToJail(currentPlayerIndex);
                 endTurn(false); // End turn immediately, no doubles bonus roll
                 return;
            }

            movePlayer(currentPlayerIndex, total);
            
            // If not doubles, turn ends after landing logic. If doubles, enable roll again.
            if (!isDoubles) {
                // Turn ends after the player interacts with the square (handled in handleLanding)
            } else {
                 addLog(`${players[currentPlayerIndex].name} gets to roll again.`);
                 isRolling = false;
                 rollBtn.disabled = false;
            }
        }

        function movePlayer(pIdx, steps) {
            const player = players[pIdx];
            let newPos = player.position + steps;

            // Handle passing GO
            if (newPos >= 40) {
                newPos = newPos % 40;
                player.money += 200;
                addLog(`${player.name} passed GO and collected $200.`);
                updateUI();
            }

            player.position = newPos;
            movePlayerToken(pIdx);
            handleLanding(pIdx);
        }

        function sendToJail(pIdx) {
            players[pIdx].position = 10; // Jail square index
            players[pIdx].jail = true;
            movePlayerToken(pIdx);
            addLog(`${players[pIdx].name} is now in Jail.`);
        }

        function handleLanding(pIdx) {
            const player = players[pIdx];
            const square = boardMapping[player.position];
            addLog(`${player.name} landed on ${square.name}.`);

            // Basic interaction logic
            switch (square.type) {
                case 'property':
                case 'railroad':
                case 'utility':
                    handlePropertyLanding(pIdx, square);
                    break;
                case 'tax':
                    payTax(pIdx, square.cost);
                    endTurnIfNoDoubles();
                    break;
                case 'gotojail':
                    sendToJail(pIdx);
                    endTurn(false); // Force turn end
                    break;
                // Simplified handling for complex squares for MVP
                case 'chance':
                case 'chest':
                    addLog("Landed on Chance/Community Chest. (Card drawing not implemented in prototype).");
                    endTurnIfNoDoubles();
                    break;
                case 'jail':
                    addLog("Just visiting Jail.");
                    endTurnIfNoDoubles();
                    break;
                case 'parking':
                    addLog("Free Parking. Nothing happens.");
                    endTurnIfNoDoubles();
                    break;
                case 'go':
                    endTurnIfNoDoubles();
                    break;
            }
        }

        function handlePropertyLanding(pIdx, square) {
            const player = players[pIdx];

            if (square.owner === null) {
                // Offer to buy
                actionArea.style.display = 'block';
                document.getElementById('property-name').textContent = square.name;
                document.getElementById('property-cost').textContent = `Cost: $${square.price}`;
                
                buyBtn.onclick = function() {
                    if (player.money >= square.price) {
                        player.money -= square.price;
                        square.owner = player.id;
                        addLog(`${player.name} bought ${square.name} for $${square.price}.`);
                        actionArea.style.display = 'none';
                        updateUI();
                        endTurnIfNoDoubles();
                    } else {
                        addLog("Not enough money!");
                    }
                };
                // Note: In real monopoly, if you don't buy, it goes to auction. 
                // For MVP, if they don't buy, they must click a "Pass" button (not implemented here to keep it simple, so they *must* buy or we auto-end turn. Let's auto end if they don't have money).
                 if (player.money < square.price) {
                      buyBtn.disabled = true;
                      buyBtn.textContent = "Cannot Afford";
                      // Auto end turn after a moment if they can't afford
                      setTimeout(() => {
                         actionArea.style.display = 'none';
                         endTurnIfNoDoubles();
                      }, 2000);
                 } else {
                      buyBtn.disabled = false;
                      buyBtn.textContent = "BUY PROPERTY";
                 }


            } else if (square.owner !== player.id) {
                // Pay rent
                const ownerIdx = square.owner - 1;
                // Simplified rent calculation (no house multiplier, simplified utility/railroad math)
                let rentDue = square.rent || 25; // Default for RRs if rent missing

                addLog(`${square.name} is owned by ${players[ownerIdx].name}. Rent is $${rentDue}.`);
                player.money -= rentDue;
                players[ownerIdx].money += rentDue;
                updateUI();
                endTurnIfNoDoubles();
            } else {
                addLog("You own this property.");
                endTurnIfNoDoubles();
            }
        }

        function payTax(pIdx, amount) {
            players[pIdx].money -= amount;
            addLog(`${players[pIdx].name} paid $${amount} tax.`);
            updateUI();
        }

        // Helper to check if we should end turn based on doubles status
        function endTurnIfNoDoubles() {
             // If the buy button is active, don't end the turn yet.
             if(actionArea.style.display === 'block' && !buyBtn.disabled) return;

             const d1 = parseInt(diceArea.textContent.split(' ')[0]);
             const d2 = parseInt(diceArea.textContent.split(' ')[2]);
             if (d1 !== d2) {
                 endTurn();
             }
        }


        function endTurn(canRollAgain = true) {
            isRolling = false;
            rollBtn.disabled = false;
            doublesCount = 0;
            
            currentPlayerIndex = (currentPlayerIndex + 1) % players.length;
            updateUI();
            addLog(`--- ${players[currentPlayerIndex].name}'s turn ---`);
        }


        // --- INITIALIZATION ---
        rollBtn.addEventListener('click', rollDice);
        updateUI();
        // Initial placement
        movePlayerToken(0);
        movePlayerToken(1);
        addLog("Game Started. Player 1's turn.");

    </script>
</body>
</html>
